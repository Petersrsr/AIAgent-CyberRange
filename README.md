# AI Agent驱动的动态攻防推演靶场平台 (PHP + MySQL)

## 1. 项目简介

本项目旨在构建一个基于 AI Agent 的动态网络安全攻防推演靶场平台。平台允许用户通过与 AI Agent 互动，在模拟真实的网络环境中进行攻防演练，从而提升实战技能。

我们当前正在逐步构建此平台的基础设施，已完成核心的用户管理系统（注册、登录、个人资料管理等），并开发了包括**命令注入**、**文件包含**、**暴力破解**等多个靶场模块。

本项目所有模块都将遵循易于在宝塔面板 (PHP 7.4 + Nginx + MySQL) 环境中部署的标准。

## 2. 功能特性

- **用户注册**: 提供安全的注册功能，用户名仅限字母和数字，密码长度 6-20 位。
- **用户登录**: 提供简洁的登录界面，并进行后端验证。
- **会话管理**: 使用 PHP Session 机制跟踪用户登录状态。
- **控制板**: 登录后进入功能控制板，展示所有可用的靶场模块。
- **个人资料**: 用户可以查看和编辑自己的详细资料（昵称、生日、性别、简介）。
- **登出功能**: 用户可以安全退出登录。
- **网站图标**: 所有页面均设置了网站图标 (Favicon)。
- **动态靶场**:
    - **命令注入**: 提供三个难度级别（简单、中等、困难），用于练习和绕过不同的安全过滤策略。
    - **文件包含**: 练习利用文件包含漏洞。
    - **暴力破解**: 模拟针对登录表单的暴力破解攻击。
    - ... 更多靶场正在建设中。
- **日志分析与导出**: 管理员可通过日志分析页面查看、筛选、统计所有用户操作日志，支持关键字搜索、分页、结果高亮、导出为 Excel。
- **角色分析报告**: 每个用户可在“角色分析”页面查看自己在各靶场、各难度下的练习表现，包括总正确率、靶场数、总尝试、总错误等统计，并获得个性化学习建议。
- - **靶场分数重置**：用户可在角色分析页面针对单个靶场一键重置分数和记录，便于反复练习和自我评估。
- - **靶场评分规则**：所有靶场均采用分难度计分，暴力破解总分10分（简单2分、中等3分、困难5分），其余每个靶场7.5分（简单1.5分、中等2分、困难4分），不可能难度不计分，总分100分。评分规则在页面有详细说明。
- - **角色分析报告升级**：支持按靶场、难度查看得分，统计区、表格区、学习建议区全面美化，支持靶场分数重置。
- **UI/UX 现代化**: 全站采用卡片式、渐变背景、统一按钮和表格风格，提升视觉体验和可用性。

## 3. 文件结构

```
.
├── db.php             # 数据库连接脚本
├── login.php          # 登录页面及逻辑处理
├── register.php       # 注册页面及逻辑处理
├── dashboard.php      # 登录后的控制板页面
├── profile.php        # 用户个人资料页面
├── edit_profile.php   # 编辑个人资料页面
├── logout.php         # 登出逻辑处理脚本
├── vulnerabilities/         # 靶场文件夹
│   ├── blind.php            # 盲注靶场页面
│   ├── command.php          # 命令注入靶场页面
│   ├── csp.php              # CSP靶场页面
│   ├── csrf.php             # CSRF靶场页面
│   ├── Dom.php              # DOM型XSS靶场页面
│   ├── file.php             # 文件包含靶场页面
│   ├── forcebreak.php       # 暴力破解靶场页面
│   ├── injection.php        # SQL注入靶场页面
│   ├── Insecure.php         # Insecure CAPTCHA靶场页面
│   ├── Reflected.php        # 反射型XSS靶场页面
│   ├── upload.php           # 文件上传靶场页面
│   ├── weak.php             # 弱加密/弱口令靶场页面
│   └── xss.php              # 存储型XSS靶场页面
├── style.css          # 前端样式文件
├── database.sql       # 数据库表结构（新安装用）
├── logo.png           # 网站图标
├── reset_challenge.php # 靶场分数重置接口
└── readme.md          # 项目说明文档
```

## 4. 部署与升级

### 步骤 1: 部署文件

将所有项目文件上传到你的网站根目录。

### 步骤 2: 创建数据库和用户

1.  登录你的 MySQL 数据库管理工具 (例如 phpMyAdmin)。
2.  创建一个新的数据库，名称为 `aibachang`。
3.  创建一个新的数据库用户，用户名为 `aibachang`，密码为 `aibachang`。
4.  授予 `aibachang` 用户对 `aibachang` 数据库的所有权限。

> **注意**: 如果你使用了不同的数据库名、用户名或密码，请务必更新 `db.php` 文件中的配置。

### 步骤 3: 导入数据表

-   **对于新用户**:
    1.  在 `aibachang` 数据库中，选择 "导入" (Import) 功能。
    2.  上传并执行 `database.sql` 文件。这将创建最新的 `users` 表并插入一条测试数据。

**示例用户数据:**
-   **用户名**: admin
-   **密码**: 123456

### 步骤 4: 访问应用

在浏览器中访问 `http://你的域名/login.php`，即可看到登录界面。你可以使用示例账户登录，或注册新账户。

## 5. 代码文件说明

-   **`db.php`**: 负责连接到 MySQL 数据库。
-   **`login.php`**: 显示登录表单，处理登录逻辑，成功后跳转到 `dashboard.php`。
-   **`register.php`**: 提供安全的注册表单（含格式校验），处理新用户创建逻辑。
-   **`dashboard.php`**: 用户登录后的主页面，展示所有可用的靶场模块。
-   **`profile.php`**: 显示用户的详细资料（用户名、昵称、生日等）。
-   **`edit_profile.php`**: 提供表单和逻辑，用于修改个人资料。
-   **`logout.php`**: 销毁 Session, 实现用户登出。
-   **`vulnerabilities/`**: 存放所有靶场模块的文件夹.
    - **`command.php`**: 命令注入靶场, 包含简单、中等、困难三个级别.
-   **`style.css`**: 为所有页面提供统一的美化样式。
-   **`database.sql`**: 包含完整 `users` 表结构的 SQL 文件, 供新安装使用。
-   **`logo.png`**: 网站的浏览器标签页图标。
-   **`log_analysis.php`**: 日志分析仪表盘，仅管理员可访问，支持日志筛选、统计、导出、删除等功能。
-   **`role_analysis.php`**: 用户角色分析报告，展示个人靶场练习表现和学习建议。
-   **`reset_challenge.php`**: 提供靶场分数重置的后端接口，接收AJAX请求，安全删除当前用户在指定靶场的所有记录。