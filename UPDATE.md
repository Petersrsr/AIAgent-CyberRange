# 项目开发日志

## 阶段一：项目初始化与基础功能构建

- **环境搭建**:
  - 指导完成 PHP 环境的安装与本地服务器的启动。
- **用户系统**:
  - 完成了包括用户注册、登录、会话管理、个人资料修改等核心功能。

## 阶段二：初步的靶场功能开发

- **命令注入 v1**:
  - 实现了初版命令注入靶场，包含简单、中等、困难三个级别。
  - 防御逻辑基于黑名单，分别禁用特定命令和特殊字符。
- **其他靶场创建**:
  - 创建了暴力破解、CSRF、文件包含等多个靶场的占位文件。

## 阶段三：项目重构与核心方向确立

- **确立新方向**:
  - 根据用户指令，项目核心方向确立为 **构建东海学院 AI Agent 驱动的网络靶场**。
  - 为此，决定以经典的 `Damn Vulnerable Web Application (DVWA)` 作为基础靶场内容的开发蓝本，为未来的AI功能构建坚实、标准化的靶场环境。
- **目录结构重构**:
  - 将所有靶场文件 (`command.php`, `csrf.php`, etc.) 统一迁移至新的 `vulnerabilities/` 目录下，使项目结构更清晰。
  - 更新了 `dashboard.php` 的链接以适应新路径。
- **靶场逻辑对齐 (DVWA Standard)**:
  - **命令注入 v2**:
    - 推翻原有逻辑，改为对齐 DVWA 的 `ping` 工具场景。
    - 防御逻辑从过滤命令改为过滤 `&&`, `;`, `|` 等命令连接符。
  - **暴力破解 v2**:
    - 推翻原有逻辑，对齐 DVWA。
    - 中等级别引入 `sleep()` 延迟。
    - 高等级别引入 Anti-CSRF Token。
    - 不可能级别结合 Token 与账户锁定。
  - **CSRF v2**:
    - 对齐 DVWA 逻辑，引入 `Referer` 验证和 CSRF Token。
    - 不可能级别要求输入当前密码进行二次验证。
  - **文件包含 v2**:
    - 对齐 DVWA 逻辑，改为 `GET` 请求。
    - 防御逻辑改为过滤 `../`、协议，以及使用白名单。

## 阶段四：UI/UX 全面优化与标准化

- **样式集中化**:
  - 将所有靶场页面内的重复 CSS 代码提取并整合进全局样式表 `style.css`。
  - 解决了因 `position: fixed` 导致的页脚重叠问题。
- **UI本地化与统一化**:
  - 将所有靶场页面的面向用户的文本（标题、标签、按钮、提示）统一翻译为中文。
  - 解决了 `CSRF` 靶场因文字过长导致的布局问题。
  - 移除了遗留的、导致 UI 不一致的"声明"横幅。
  - 修正了暴力破解靶场用户名输入框被错误硬编码为 `admin` 的问题。
- **难度标签标准化**:
  - 统一所有靶场的难度选择器为"级别1：简单"、"级别2：中等"、"级别3：困难"、"级别4：不可能"的格式。

## 阶段五：控制板 (Dashboard) 功能对齐

- **布局调整**:
  - 将控制板的靶场卡片布局从每行4个调整为每行2个，提升可读性。
- **靶场列表同步**:
  - 根据用户指令，精确同步控制板的靶场列表与 DVWA 保持一致。
  - 移除了项目中多余的靶场条目（如XXE, SSRF, IDOR等）。
  - 补全了 DVWA 中有而项目中缺失的 `Insecure CAPTCHA` 靶场。
  - 为所有未开发靶场设置了"敬请期待"的禁用状态。 

## 阶段六：核心功能开发与体验优化

- **用户中心模块**:
  - 从零构建了用户个人资料的查看 (`profile.php`) 和编辑 (`edit_profile.php`) 功能。
  - **Hotfix (密码修改)**: 修复了因数据库连接管理不当导致的密码修改失败的严重Bug，重构逻辑并引入PRG (Post/Redirect/Get) 设计模式以优化用户体验和状态管理。
  - **认证流程重构**: 根据Web标准实践，将密码修改功能从用户中心剥离，重构为登录前的"忘记密码"流程 (`forgot_password.php`)。
  - **引入教学彩蛋**: 在"忘记密码"模块中，根据设计，有意地引入了"用户名枚举"漏洞作为靶场的一个教学案例。

- **全局UI/UX增强**:
  - **品牌化**: 在非靶场核心页面和文档中，统一项目名称为"东海学院 AI Agent 驱动的网络靶场"。
  - **专业化页脚**: 为全站所有页面添加了包含版权和备案信息的响应式页脚。
  - **布局修复**: 使用 Flexbox 布局模型，彻底解决了页面内容不足时页脚"浮空"的问题，确保了视觉一致性。
  - **内容完善**: 新增了 `help.php` 页面，作为所有靶场的帮助中心，并统一了各靶场页头的入口。
  - **UI重构 (个人中心)**: 针对用户反馈的UI不一致问题，将个人资料和编辑页面重构为专业的两栏式布局，并修复了因此产生的文本对齐Bug。 
  - **UI重构 (控制板)**: 优化了控制板的布局，使其更加紧凑、易于操作。

- **靶场开发**:
- 新增“日志分析”功能，支持日志筛选、统计、导出、删除等操作，仅管理员可用。
- 新增“角色分析”页面，用户可查看自己在各靶场、各难度下的表现，并获得个性化学习建议。
- 角色分析、日志分析、控制板等页面 UI/UX 全面升级，采用卡片式布局、渐变背景、统一按钮和表格风格。
- 优化了表格列宽、按钮样式、下拉菜单等细节，提升整体美观性和易用性。
- 修复了部分页面的数据库字段、变量名不一致等兼容性问题。 

## 阶段七：角色分析与靶场重置功能完善

- **角色分析评分规则升级**：
  - 评分规则细化为分靶场、分难度计分，暴力破解总分10分（简单2分、中等3分、困难5分），其余每个靶场7.5分（简单1.5分、中等2分、困难4分），不可能难度不计分，总分100分。
  - 评分规则在“关于得分”弹窗中详细说明，表格区按难度展示得分。
- **靶场分数重置功能**：
  - 在角色分析页面支持一键重置当前靶场分数和记录，弹窗确认，AJAX无刷新操作，便于用户反复练习。
  - 新增 `reset_challenge.php`，安全处理分数重置请求。
- **UI/UX细节优化**：
  - 角色分析表格列宽、按钮间距、弹窗风格进一步优化，保证内容不换行，提升视觉一致性。
  - 靶场筛选下拉菜单名称与 dashboard 保持一致，兼容多种英文名写法。 